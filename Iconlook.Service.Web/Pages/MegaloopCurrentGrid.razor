@using ClickEventArgs = Syncfusion.Blazor.Buttons.ClickEventArgs
@inject HttpContextAccessor HttpAccessor
<style>
    .address-name {
        padding: 3px 7px;
        border-radius: 3px;
        background-color: #e1fafd;
        border: solid 1px #1aaaba;
    }

    .staked_amount .number-part {
        font-weight: 600;
    }

    .staked_amount .fraction-part {
        font-weight: 400;
    }

    .unstaking_amount .number-part {
        font-weight: 700;
    }

    .unstaking_amount .fraction-part {
        font-weight: 500;
    }
</style>
<SfGrid @ref="SfGrid"
         ID="current_grid"
         EnableHover="false"
         AllowPaging="Paging"
         EnableAltRow="false"
         AllowSorting="Sorting"
         AllowSelection="false"
         GridLines="GridLine.Horizontal"
         TValue="UnstakingAddressResponse">
    <GridPageSettings PageSize="PageSize" PageSizes="PageSizes"></GridPageSettings>
    <SfDataManager Url="/api/v1/address/list/unstaking" Adaptor="Adaptors.WebApiAdaptor"></SfDataManager>
    <GridColumns>
        <GridColumn HeaderText="Address" Field="@nameof(UnstakingAddressResponse.Hash)">
            <Template>
                @{
                    if (context is UnstakingAddressResponse address)
                    {
                        <a class="primary no-underline" href="https://tracker.icon.foundation/address/@address.Hash">
                            <span class="fs-n1 mono">@address.Hash</span>
                        </a>
                    }
                }
            </Template>
        </GridColumn>
        <GridColumn Width="145" HeaderText="Bet" TextAlign="TextAlign.Right" HeaderTextAlign="TextAlign.Right" Field="@nameof(UnstakingAddressResponse.Unstaking)">
            <Template>
                @{
                    if (context is UnstakingAddressResponse address)
                    {
                        if (address.Unstaking >= 500000)
                        {
                            <i class="fas mr-1 fs-n2 fa-whale special"></i>
                        }
                        if (address.Unstaking > 100000 && address.Unstaking < 500000)
                        {
                            <i class="fal mr-1 fs-n2 fa-fish special"></i>
                        }
                        if (IsMobile)
                        {
                            <span class="mono ls-n2 font-weight-semibold">@address.Unstaking.ToString("N0")</span>
                            <span class="pl-1 text-light font-weight-light">ICX</span>
                        }
                        else
                        {
                            <span class="mono ls-n2 unstaking_amount">@address.Unstaking.ToIcxString()</span>
                            <span class="pl-1 text-light font-weight-light">ICX</span>
                        }
                    }
                }
            </Template>
        </GridColumn>
    </GridColumns>
</SfGrid>

@code
{
    protected bool IsMobile;

    [Parameter]
    public bool Paging { get; set; }

    [Parameter]
    public bool Sorting { get; set; }

    [Parameter]
    public int PageSize { get; set; }

    [Parameter]
    public object PageSizes { get; set; }

    protected SfGrid<UnstakingAddressResponse> SfGrid;

    private void ChipListOnClick(ClickEventArgs args)
    {
        SfGrid.Query = new Query().AddParams("filter", ((dynamic) args.Data).value);
    }

    protected override void OnInitialized()
    {
        IsMobile = HttpAccessor.Context.Request.Headers["User-Agent"].ToString().Contains("Mobile");
    }
}