@inject HttpContextAccessor HttpContext
<style>
    .peer-state-sync {
        color: black;
        padding: 10px 0;
        border-radius: 4px;
        background-color: #ffc107;
    }

    .peer-state-idle {
        color: #969696;
        padding: 10px 0;
        border-radius: 4px;
        background-color: #f5f5f5;
    }

    .peer-state-busy {
        color: white;
        padding: 10px 0;
        font-weight: bold;
        border-radius: 4px;
        background-color: limegreen;
    }

    .online-status {
        color: #00a1b3;
    }
</style>
<style media="(max-width: 769px)">
    .peer-state span {
        margin-top: 0px !important;
    }

    .peer-produced-blocks {
        font-size: 12px;
        font-weight: 300 !important;
    }

    #production_grid .e-rowcell .fa-dot-circle {
        margin-top: 3px;
    }
</style>
<SfGrid RowHeight="40"
        EnableHover="false"
        EnableAltRow="false"
        ID="production_grid"
        TValue="PeerResponse"
        AllowSelection="false"
        ClipMode="ClipMode.Ellipsis"
        GridLines="GridLine.Horizontal"
        Query="@(new Query().AddParams("take", 22))">
    <SfDataManager Url="/api/v1/peers" Adaptor="Adaptors.WebApiAdaptor"></SfDataManager>
    <GridColumns>
        <GridColumn Width="@((IsMobile ? 15 : 20).ToString())" Field="@nameof(PRepResponse.Ranking)">
            <Template>
                <i class="fad fs-n2 fa-dot-circle online-status"></i>
            </Template>
        </GridColumn>
        <GridColumn Width="@((IsMobile ? 30 : 40).ToString())" Field="@nameof(PeerResponse.Ranking)">
            <Template>
                @{
                    if (context is PeerResponse peer)
                    {
                        <span class="mono font-weight-bold">@peer.Ranking</span>
                    }
                }
            </Template>
        </GridColumn>
        <GridColumn Field="@nameof(PRepResponse.Name)">
            <Template>
                @{
                    if (context is PeerResponse peer)
                    {
                        var font_weight = peer.State == "BlockGenerate" ? "font-weight-bold" : null;
                        <div class="d-flex align-items-center" style="margin-top: 1px;">
                            <img width="18" height="18" style="margin-top: -1px; margin-right: 8px;" src="@StringHelpers.ParseLogoUrl(peer.LogoUrl)">
                            <a class="secondary @font_weight peer-name peer-name-@peer.Id" href="https://tracker.icon.foundation/address/@peer.Id">@peer.Name</a>
                        </div>
                    }
                }
            </Template>
        </GridColumn>
        <GridColumn Width="@((IsMobile ? 45 : 50).ToString())" Field="@nameof(PeerResponse.State)">
            <Template>
                @{
                    if (context is PeerResponse peer)
                    {
                        var state = "idle";
                        if (peer.State == "Vote") { state = "idle"; }
                        if (peer.State == "BlockSync") { state = "sync"; }
                        if (peer.State == "BlockGenerate") { state = "busy"; }
                        <div style="width: 45px;" class="ls-2 fs-n3 d-inline-flex peer-state peer-state-@state peer-state-@peer.Id justify-content-center">
                            <span style="margin-top: 1px; margin-left: 1px;">@state.ToUpper()</span>
                        </div>
                    }
                }
            </Template>
        </GridColumn>
        <GridColumn Width="@((IsMobile ? 85 : 100).ToString())" TextAlign="TextAlign.Right" Field="@nameof(PeerResponse.ProducedBlocks)">
            <Template>
                @{
                    if (context is PeerResponse peer)
                    {
                        var font_weight = peer.State == "BlockGenerate" ? "font-weight-semibold" : null;
                        <div class="text-light">
                            <span class="mono ls-n2 @font_weight peer-produced-blocks peer-produced-blocks-@peer.Id" number="@peer.ProducedBlocks">@peer.ProducedBlocks.ToString("N0")</span>
                            <i class="fal ml-1 fs-n2 fa-cube"></i>
                        </div>
                    }
                }
            </Template>
        </GridColumn>
        <GridColumn Visible="@(!IsMobile)" Width="75" TextAlign="TextAlign.Right" Field="@nameof(PeerResponse.ProductivityPercentage)">
            <Template>
                @{
                    if (context is PeerResponse peer)
                    {
                        <span class="mono fs-n1 ls-n1 font-weight-semibold">@peer.ProductivityPercentage.ToString("P2")</span>
                    }
                }
            </Template>
        </GridColumn>
    </GridColumns>
</SfGrid>

@code
{
    bool IsMobile;

    protected override void OnInitialized()
    {
        IsMobile = HttpContext.Context.Request.Headers["User-Agent"].ToString().Contains("Mobile");
    }
}