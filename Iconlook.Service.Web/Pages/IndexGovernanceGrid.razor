@inject HttpContextAccessor HttpContext
<style>
    .online-status { color: #00a1b3; }
</style>
<style media="(max-width: 769px)">
    .prep_votes { font-weight: 300 !important; }

    .prep_votes24h_change { margin-top: 3px !important; }

    #governance_grid td.e-rowcell:nth-child(1) { width: 20px; }

    #governance_grid td.e-rowcell:nth-child(2) { width: 30px; }

    #governance_grid td.e-rowcell:nth-child(3) { width: auto; }

    #governance_grid td.e-rowcell:nth-child(4) { width: 105px; }

    #governance_grid td.e-rowcell:nth-child(5) { width: 48px; }

    #governance_grid td.e-rowcell:nth-child(1) .fa-dot-circle { margin-top: 3px; }
</style>
<EjsGrid RowHeight="40"
         EnableHover="false"
         EnableAltRow="false"
         ID="governance_grid"
         TValue="PRepResponse"
         AllowSelection="false"
         ClipMode="ClipMode.Ellipsis"
         GridLines="GridLine.Horizontal"
         Query="@(new Query().AddParams("take", 22))">
    <EjsDataManager Url="/api/v1/prep/list" Adaptor="Adaptors.WebApiAdaptor"></EjsDataManager>
    <GridColumns>
        <GridColumn Width="20" Field="@nameof(PRepResponse.Ranking)">
            <Template>
                <i class="fad fs-n2 fa-dot-circle online-status"></i>
            </Template>
        </GridColumn>
        <GridColumn Width="40" Field="@nameof(PRepResponse.Ranking)">
            <Template>
                @{
                    if (context is PRepResponse prep)
                    {
                        <span class="mono font-weight-bold">@prep.Ranking</span>
                    }
                }
            </Template>
        </GridColumn>
        <GridColumn Field="@nameof(PRepResponse.Name)">
            <Template>
                @{
                    if (context is PRepResponse prep)
                    {
                        <div class="d-flex align-items-center" style="margin-top: 1px;">
                            <img width="18" height="18" style="margin-top: -1px; margin-right: 8px;" src="@StringHelpers.ParseLogoUrl(prep.LogoUrl)">
                            <a class="prep_name secondary" href="https://tracker.icon.foundation/address/@prep.Id">@prep.Name</a>
                        </div>
                    }
                }
            </Template>
        </GridColumn>
        <GridColumn Width="105" TextAlign="TextAlign.Right" Field="@nameof(PRepResponse.Votes)">
            <Template>
                @{
                    if (context is PRepResponse prep)
                    {
                        <span class="mono ls-n2 prep_votes">@prep.Votes.ToString("N0")</span>
                        <span style="margin-left: 1px;" class="fs-n2 text-light font-weight-light">votes</span>
                    }
                }
            </Template>
        </GridColumn>
        <GridColumn Width="60" TextAlign="TextAlign.Right">
            <Template>
                @{
                    if (context is PRepResponse prep)
                    {
                        if (Math.Abs(prep.Votes24HChange) < 1000)
                        {
                            <div style="padding-top: 1px; padding-left: 5px;" class="mono text-light">0K</div>
                        }
                        else
                        {
                            var vote24h = Math.Abs(prep.Votes24HChange);
                            var direction = prep.Votes24HChange > 0 ? "up" : "down";
                            var color = prep.Votes24HChange > 0 ? "positive" : "negative";
                            <div class="prep_votes24h_change" style="margin-top: 1px;">
                                <span class="fad fs-n2 @color-light fa-long-arrow-@direction" style="opacity: 0.75; margin-right: 2px;"></span>
                                @if (vote24h < 1000000)
                                {
                                    <span class="mono @color-dark">@($"{vote24h / 1000:##0}K")</span>
                                }
                                else
                                {
                                    <span class="mono @color-dark font-weight-semibold">@($"{vote24h / 1000000m:0.0}M")</span>
                                }
                            </div>
                        }
                    }
                }
            </Template>
        </GridColumn>
        <GridColumn Width="70" TextAlign="TextAlign.Right" HideAtMedia="(min-width: 769px)" Field="@nameof(PRepResponse.DelegatedPercentage)">
            <Template>
                @{
                    if (context is PRepResponse prep)
                    {
                        <span class="mono font-weight-semibold">@prep.DelegatedPercentage.ToString("P2")</span>
                    }
                }
            </Template>
        </GridColumn>
    </GridColumns>
</EjsGrid>

@code
{
    bool IsMobile;

    protected override void OnInitialized()
    {
        IsMobile = HttpContext.Context.Request.Headers["User-Agent"].ToString().Contains("Mobile");
    }
}