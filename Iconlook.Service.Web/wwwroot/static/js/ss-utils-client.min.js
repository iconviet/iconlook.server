$(document).ready(function() {
    var username;
    var source = new window.EventSource('/sse/stream?channel=iconlook');

    source.addEventListener('error', function (e) {
        console.log("ERROR", e);
    }, false);

    $(source).handleServerEvents({
        handlers: {
            onConnect: function (subscription) {
                username = subscription.displayName;
                console.log("[" + username + "] " + "connected", subscription);
            }
        },
        success: function (selector, json, message) {
            if (!selector.startsWith('cmd.on')) {
                console.log("[" + username + "] " + "received " + message.cmd, json);
            }
        }
    });
})